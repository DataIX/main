#summary FreeBSD ZFS ARC Summary Perl Script
#labels FreeBSD,SunOS,Solaris,OpenSolaris,CuddleTech,Featured,ZFS,Memory,Statistics,Download,Perl,Summary

= Introduction =

This perl script is used to prep a report for user review with the contents being that of the ZFS ARC Statistics contained in sysctl kstats MIBs.

  Quoting the original author of the script for Sun based systems:

  While ARC is an amazing achievement its memory consumption raises doubts and questions in many administrators and users who view memory as a precious commodity. The Kstat facility provides access to a variety of ARC counters, but interpretting these properly is complex and non-intuative in their raw form, without spending several hours in the arc.c code. The purpose of arc_summary.pl is to provide a historical analysis of the ZFS ARC.

This script is still work in progress.
  * Currently [http://jhell.googlecode.com/files/arc_summary.pl arc_summary.pl] tries to make use of all kstats that are available.
  * It includes some specific system information such as uname, uptime & date in a header.
  * Spills relevant sysctl MIBs at the bottom of the report.
  * Includes kernel memory usage.
  * Has L2 ARC kstats.
  * Current with sysctl MIBs as of ZFS v13. ( Please report new sysctls [mailto:jhell@dataix.net here])

== Download ==

  # [http://jhell.googlecode.com/files/arc_summary.pl Stable arc_summary.pl]
  # [http://code.google.com/p/jhell/source/browse/base#base/head/scripts/zfs/arc_summary Development Version]

== Links ==

  # [http://www.FreeBSD.org/ FreeBSD.org Website]
  # [http://wiki.FreeBSD.org/ FreeBSD.org WiKi]
  # [http://www.sun.com/ Sun Microsystems]

=== Updates ===

Revision 19:
  * Some reformatting has been done to accommodate for the removal of the header and sysctl MIBs.
  * The following editable variables have been included for convenience:
  {{{
  my $useheader = 1;	# Change to 0 to disable FreeBSD header.
  my $usetunable = 1;	# Change to 0 to disable sysctl MIB spill at bottom.
  }}}

=== Example output ===

{{{
------------------------------------------------------------------------
System Summary								Sat Apr 24 17:22:02 2010

FreeBSD 7.3-STABLE #0 r207062M Thu Apr 22 10:36:14 EDT 2010 root

Kernel Version:								703100 (osreldate)

Hardware Platform:							i386
Processor Architecture:						i386

17:22  up 1 day, 21:05, 4 users, load averages: 0.11, 0.11, 0.13
------------------------------------------------------------------------

Physical Memory:							1009.91M
Page Size:									4096

Kernel Memory
TOTAL:										170.96M
DATA:								94.99%	162.40M
TEXT:								5.01%	8.56M

ARC Summary
	Storage pool Version:					13 (spa)
	Filesystem Version:						3 (zpl)
	Memory Throttle Count:					150

ARC Misc:
	Deleted:								1185420
	Recycle Misses:							740640
	Mutex Misses:							714
	Evict Skips:							714

ARC Size:
	Current Size:					30.08%	144.40M (arcsize)
	Target Size: (Adaptive)			35.84%	172.03M (c)
	Min Size (Hard Limit):			16.67%	80.00M (c_min)
	Max Size (High Water):			~6:1	480.00M (c_max)

ARC Size Breakdown:
	Recently Used Cache Size:		98.91%	170.15M (p)
	Frequently Used Cache Size:		1.09%	1.87M (c-p)

ARC Hash Breakdown:
	Elements Max:							369547
	Elements Current:				79.58%	294096
	Collisions:								1132690
	Chain Max:								44
	Chains:									16384

ARC Efficiency:
	Cache Access Total:						22086496
	Cache Hit Ratio:				93.09%	20561412
	Cache Miss Ratio:				6.91%	1525084
	Actual Hit Ratio:				76.28%	16847498

	Data Demand Efficiency:			94.24%
	Data Prefetch Efficiency:		76.70%

	CACHE HITS BY CACHE LIST:
	  Anonymous:					15.05%	3093941
	  Most Recently Used:			10.00%	2056877 (mru)
	  Most Frequently Used:			71.93%	14790621 (mfu)
	  Most Recently Used Ghost:		0.73%	150336 (mru_ghost)
	  Most Frequently Used Ghost:	2.28%	469637 (mfu_ghost)

	CACHE HITS BY DATA TYPE:
	  Demand Data:					17.44%	3586684
	  Prefetch Data:				0.40%	81644
	  Demand Metadata:				57.40%	11802747
	  Prefetch Metadata:			24.76%	5090337

	CACHE MISSES BY DATA TYPE:
	  Demand Data:					14.36%	219054
	  Prefetch Data:				1.63%	24803
	  Demand Metadata:				59.32%	904699
	  Prefetch Metadata:			24.69%	376528

L2 ARC Summary
	Low Memory Aborts:						3960
	Bad Checksums:							0
	IO Errors:								0
	R/W Clashes:							106
	Free on Write:							5714

L2 ARC Size:
	Current Size: (Adaptive)				2418.31M
	Header Size:					1.70%	41.18M

L2 ARC Evicts:
	Lock Retries:							0
	Upon Reading:							0

L2 ARC Breakdown:
	Access Total:							875086
	Hit Ratio:						99.99%	874980
	Miss Ratio:						0.01%	106
	Feeds:									157791

	WRITES:
	  Sent Total:							11372
	  Done Ratio:					100.00%	11372
	  Error Ratio:					0.00%	0

VDEV Cache Summary
	Access Total:							443247
	Hits Ratio:						74.78%	331443
	Miss Ratio:						25.22%	111804
	Delegations:							85760

ZFS Tunable (sysctl):
	kern.maxusers=512
	vfs.zfs.arc_meta_limit=125829120
	vfs.zfs.arc_meta_used=144659580
	vfs.zfs.mdcomp_disable=0
	vfs.zfs.arc_min=83886080
	vfs.zfs.arc_max=503316480
	vfs.zfs.zfetch.array_rd_sz=1048576
	vfs.zfs.zfetch.block_cap=256
	vfs.zfs.zfetch.min_sec_reap=2
	vfs.zfs.zfetch.max_streams=8
	vfs.zfs.prefetch_disable=0
	vfs.zfs.recover=0
	vfs.zfs.txg.synctime=5
	vfs.zfs.txg.timeout=30
	vfs.zfs.scrub_limit=10
	vfs.zfs.vdev.cache.bshift=16
	vfs.zfs.vdev.cache.size=10485760
	vfs.zfs.vdev.cache.max=16384
	vfs.zfs.vdev.aggregation_limit=131072
	vfs.zfs.vdev.ramp_rate=2
	vfs.zfs.vdev.time_shift=6
	vfs.zfs.vdev.min_pending=4
	vfs.zfs.vdev.max_pending=35
	vfs.zfs.cache_flush_disable=0
	vfs.zfs.zil_disable=0
	vfs.zfs.version.zpl=3
	vfs.zfs.version.vdev_boot=1
	vfs.zfs.version.spa=13
	vfs.zfs.version.dmu_backup_stream=1
	vfs.zfs.version.dmu_backup_header=2
	vfs.zfs.version.acl=1
	vfs.zfs.debug=0
	vfs.zfs.super_owner=0
	vm.kmem_size=536870912
	vm.kmem_size_scale=3
	vm.kmem_size_min=0
	vm.kmem_size_max=536870912
------------------------------------------------------------------------
}}}
